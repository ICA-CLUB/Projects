<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostel Complaint Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .login-card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .dashboard-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .status-pill {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 500;
            font-size: 0.75rem;
        }
        .status-pending { background-color: #fef9c3; color: #854d0e; }
        .status-in-progress { background-color: #dbeafe; color: #1e40af; }
        .status-resolved { background-color: #d1fae5; color: #065f46; }
        .hidden { display: none; }
    </style>
</head>
<body class="antialiased text-slate-800">

    <!-- Main Container -->
    <div id="app" class="min-h-screen">

        <!-- Login Page -->
        <div id="login-page" class="flex items-center justify-center min-h-screen px-4">
            <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-2xl login-card">
                <div>
                    <h1 class="text-3xl font-bold text-center text-slate-900">Hostel Complaint System</h1>
                    <p class="text-center text-slate-500">Select your role to login</p>
                </div>
                <div class="space-y-4">
                    <button onclick="login('student')" class="w-full px-4 py-3 font-semibold text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                        Login as Student
                    </button>
                    <button onclick="login('warden')" class="w-full px-4 py-3 font-semibold text-white bg-sky-600 rounded-lg hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 transition-colors">
                        Login as Warden
                    </button>
                    <button onclick="login('maintenance')" class="w-full px-4 py-3 font-semibold text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 transition-colors">
                        Login as Maintenance
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Area (Initially Hidden) -->
        <div id="dashboard-area" class="hidden">
            <header class="bg-white shadow-sm">
                <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                    <h1 id="dashboard-title" class="text-2xl font-bold text-slate-900">Dashboard</h1>
                    <button onclick="logout()" class="px-4 py-2 text-sm font-medium text-white bg-slate-600 rounded-lg hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 transition-colors">Logout</button>
                </div>
            </header>
            <main class="p-4 sm:p-6 lg:p-8">
                <!-- Student Dashboard -->
                <div id="student-dashboard" class="hidden">
                    <!-- Announcements -->
                    <div class="mb-8">
                        <h2 class="text-xl font-semibold mb-4 text-slate-800">Announcements</h2>
                        <div id="student-announcements" class="p-6 bg-white rounded-xl shadow space-y-3">
                            <!-- Announcements will be injected here -->
                        </div>
                    </div>
                    <!-- My Complaints -->
                    <div>
                        <div class="flex justify-between items-center mb-4">
                             <h2 class="text-xl font-semibold text-slate-800">My Complaints</h2>
                             <button onclick="openComplaintModal()" class="px-5 py-2 font-semibold text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors shadow-sm">File New Complaint</button>
                        </div>
                        <div id="student-complaints" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Complaints will be injected here -->
                        </div>
                    </div>
                </div>

                <!-- Warden Dashboard -->
                <div id="warden-dashboard" class="hidden">
                    <div class="flex justify-between items-center mb-6">
                         <h2 class="text-xl font-semibold text-slate-800">Manage Complaints</h2>
                         <button onclick="openAnnouncementModal()" class="px-5 py-2 font-semibold text-white bg-sky-600 rounded-lg hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 transition-colors shadow-sm">Post Announcement</button>
                    </div>
                    <div id="warden-complaints" class="bg-white rounded-xl shadow overflow-hidden">
                        <table class="min-w-full divide-y divide-slate-200">
                             <thead class="bg-slate-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Ticket ID</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Room</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Category</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Description</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Assigned To</th>
                                    <th scope="col" class="relative px-6 py-3"><span class="sr-only">Assign</span></th>
                                </tr>
                            </thead>
                            <tbody id="warden-complaints-table" class="bg-white divide-y divide-slate-200">
                                <!-- Warden complaints table rows will be injected here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Maintenance Dashboard -->
                <div id="maintenance-dashboard" class="hidden">
                     <h2 class="text-xl font-semibold mb-4 text-slate-800">Assigned Tasks</h2>
                     <div id="maintenance-tasks" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Maintenance tasks will be injected here -->
                     </div>
                </div>
            </main>
        </div>

    </div>

    <!-- Modals -->
    <!-- New Complaint Modal (Student) -->
    <div id="complaint-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="w-full max-w-lg p-8 bg-white rounded-2xl shadow-xl space-y-4">
            <h2 class="text-2xl font-bold text-slate-900">File a New Complaint</h2>
            <form id="complaint-form" class="space-y-4">
                <div>
                    <label for="room-number" class="block text-sm font-medium text-slate-700">Room Number</label>
                    <input type="text" id="room-number" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="category" class="block text-sm font-medium text-slate-700">Category</label>
                    <select id="category" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option>Electrical</option>
                        <option>Plumbing</option>
                        <option>Carpentry</option>
                        <option>Internet</option>
                        <option>Other</option>
                    </select>
                </div>
                <div>
                    <label for="description" class="block text-sm font-medium text-slate-700">Description</label>
                    <textarea id="description" rows="4" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                </div>
                <div>
                    <label for="photo" class="block text-sm font-medium text-slate-700">Upload Photo (Optional)</label>
                    <input type="file" id="photo" accept="image/*" class="mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                </div>
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" onclick="closeComplaintModal()" class="px-5 py-2 text-sm font-medium text-slate-700 bg-slate-100 rounded-lg hover:bg-slate-200">Cancel</button>
                    <button type="submit" class="px-5 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700">Submit</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- New Announcement Modal (Warden) -->
    <div id="announcement-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="w-full max-w-lg p-8 bg-white rounded-2xl shadow-xl space-y-4">
            <h2 class="text-2xl font-bold text-slate-900">Post New Announcement</h2>
            <form id="announcement-form" class="space-y-4">
                <div>
                    <label for="announcement-text" class="block text-sm font-medium text-slate-700">Message</label>
                    <textarea id="announcement-text" rows="5" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"></textarea>
                </div>
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" onclick="closeAnnouncementModal()" class="px-5 py-2 text-sm font-medium text-slate-700 bg-slate-100 rounded-lg hover:bg-slate-200">Cancel</button>
                    <button type="submit" class="px-5 py-2 text-sm font-medium text-white bg-sky-600 rounded-lg hover:bg-sky-700">Post</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- MOCK DATABASE ---
        let complaints = [
            { id: 1, ticketId: 'HSTL-8426', room: '201A', category: 'Electrical', description: 'Fan not working.', status: 'Pending', assignedTo: null, filedOn: new Date('2024-07-20T09:00:00Z'), studentId: 'student1' },
            { id: 2, ticketId: 'HSTL-9173', room: '305B', category: 'Plumbing', description: 'Shower head is leaking constantly.', status: 'In Progress', assignedTo: 'staff1', filedOn: new Date('2024-07-19T14:30:00Z'), studentId: 'student2' },
            { id: 3, ticketId: 'HSTL-3345', room: '110A', category: 'Internet', description: 'WiFi is very slow and disconnects frequently.', status: 'Resolved', assignedTo: 'staff2', filedOn: new Date('2024-07-18T11:00:00Z'), resolvedOn: new Date('2024-07-19T16:45:00Z'), studentId: 'student1' },
            { id: 4, ticketId: 'HSTL-5821', room: '412C', category: 'Carpentry', description: 'Wardrobe door hinge is broken.', status: 'Pending', assignedTo: null, filedOn: new Date('2024-07-21T08:15:00Z'), studentId: 'student3' }
        ];

        let announcements = [
            { id: 1, message: 'Water supply will be interrupted tomorrow from 10 AM to 12 PM for maintenance.', postedOn: new Date() },
            { id: 2, message: 'The annual hostel sports day will be held next Saturday. Please register your names with the sports secretary.', postedOn: new Date(new Date().setDate(new Date().getDate() - 2)) }
        ];
        
        const maintenanceStaff = [
            { id: 'staff1', name: 'Ramesh Kumar (Plumbing)' },
            { id: 'staff2', name: 'Suresh Singh (Electrical/Internet)' },
            { id: 'staff3', name: 'Anil Verma (Carpentry)' }
        ];
        
        let currentUser = null;
        const MOCK_STUDENT_ID = 'student1'; // For demo purposes, we'll assume this student is logged in

        // --- DOM Elements ---
        const loginPage = document.getElementById('login-page');
        const dashboardArea = document.getElementById('dashboard-area');
        const dashboardTitle = document.getElementById('dashboard-title');
        
        const studentDashboard = document.getElementById('student-dashboard');
        const wardenDashboard = document.getElementById('warden-dashboard');
        const maintenanceDashboard = document.getElementById('maintenance-dashboard');
        
        const studentAnnouncementsContainer = document.getElementById('student-announcements');
        const studentComplaintsContainer = document.getElementById('student-complaints');
        const wardenComplaintsTable = document.getElementById('warden-complaints-table');
        const maintenanceTasksContainer = document.getElementById('maintenance-tasks');
        
        const complaintModal = document.getElementById('complaint-modal');
        const complaintForm = document.getElementById('complaint-form');
        const announcementModal = document.getElementById('announcement-modal');
        const announcementForm = document.getElementById('announcement-form');

        // --- AUTHENTICATION & ROUTING ---
        function login(role) {
            currentUser = role;
            loginPage.classList.add('hidden');
            dashboardArea.classList.remove('hidden');
            
            switch(role) {
                case 'student':
                    showStudentDashboard();
                    break;
                case 'warden':
                    showWardenDashboard();
                    break;
                case 'maintenance':
                    // In a real app, you'd have a specific staff ID. Here we'll use a mock one.
                    currentUser = { role: 'maintenance', id: 'staff1' }; 
                    showMaintenanceDashboard();
                    break;
            }
        }

        function logout() {
            currentUser = null;
            loginPage.classList.remove('hidden');
            dashboardArea.classList.add('hidden');
            studentDashboard.classList.add('hidden');
            wardenDashboard.classList.add('hidden');
            maintenanceDashboard.classList.add('hidden');
        }

        // --- DASHBOARD RENDERING ---
        function showStudentDashboard() {
            dashboardTitle.textContent = 'Student Dashboard';
            studentDashboard.classList.remove('hidden');
            renderStudentAnnouncements();
            renderStudentComplaints();
        }

        function showWardenDashboard() {
            dashboardTitle.textContent = 'Warden Dashboard';
            wardenDashboard.classList.remove('hidden');
            renderWardenComplaints();
        }

        function showMaintenanceDashboard() {
            dashboardTitle.textContent = `Maintenance Dashboard (${getStaffName(currentUser.id)})`;
            maintenanceDashboard.classList.remove('hidden');
            renderMaintenanceTasks();
        }
        
        // --- STUDENT VIEW LOGIC ---
        function renderStudentAnnouncements() {
            studentAnnouncementsContainer.innerHTML = announcements
                .sort((a, b) => b.postedOn - a.postedOn)
                .map(ann => `
                    <div class="border-l-4 border-indigo-500 pl-4 py-2">
                        <p class="text-slate-800">${ann.message}</p>
                        <p class="text-xs text-slate-500 mt-1">${ann.postedOn.toLocaleString()}</p>
                    </div>
                `).join('');
            if(announcements.length === 0) {
                 studentAnnouncementsContainer.innerHTML = '<p class="text-slate-500">No announcements at the moment.</p>';
            }
        }

        function renderStudentComplaints() {
            const myComplaints = complaints.filter(c => c.studentId === MOCK_STUDENT_ID);
            studentComplaintsContainer.innerHTML = myComplaints
                .sort((a, b) => b.filedOn - a.filedOn)
                .map(c => `
                <div class="bg-white p-6 rounded-xl shadow dashboard-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-semibold text-indigo-600">${c.category}</p>
                            <p class="text-xs text-slate-500">Ticket ID: ${c.ticketId}</p>
                        </div>
                        ${createStatusPill(c.status)}
                    </div>
                    <div class="mt-4">
                        <p class="font-semibold text-slate-800">Room: ${c.room}</p>
                        <p class="text-slate-600 mt-1">${c.description}</p>
                    </div>
                    <div class="mt-4 border-t pt-3 text-xs text-slate-500">
                        <p>Filed on: ${c.filedOn.toLocaleString()}</p>
                        ${c.assignedTo ? `<p>Assigned to: ${getStaffName(c.assignedTo)}</p>` : ''}
                        ${c.resolvedOn ? `<p>Resolved on: ${c.resolvedOn.toLocaleString()}</p>` : ''}
                    </div>
                </div>
            `).join('');
            if(myComplaints.length === 0) {
                 studentComplaintsContainer.innerHTML = '<p class="text-slate-500 text-center col-span-full">You have not filed any complaints yet.</p>';
            }
        }

        // --- WARDEN VIEW LOGIC ---
        function renderWardenComplaints() {
             wardenComplaintsTable.innerHTML = complaints
                .sort((a, b) => b.filedOn - a.filedOn)
                .map(c => `
                <tr class="hover:bg-slate-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">${c.ticketId}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${c.room}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${c.category}</td>
                    <td class="px-6 py-4 whitespace-normal text-sm text-slate-500 max-w-xs truncate">${c.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${createStatusPill(c.status)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
                        ${c.assignedTo ? getStaffName(c.assignedTo) : 'Not Assigned'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        ${c.status === 'Pending' ? createAssignDropdown(c.id) : ''}
                    </td>
                </tr>
            `).join('');
        }

        // --- MAINTENANCE VIEW LOGIC ---
        function renderMaintenanceTasks() {
            const myTasks = complaints.filter(c => c.assignedTo === currentUser.id && c.status !== 'Resolved');
            maintenanceTasksContainer.innerHTML = myTasks
                .sort((a, b) => a.status === 'Pending' ? -1 : 1) // Show pending first
                .map(c => `
                <div class="bg-white p-6 rounded-xl shadow dashboard-card">
                     <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-semibold text-emerald-600">${c.category}</p>
                            <p class="text-xs text-slate-500">Ticket ID: ${c.ticketId}</p>
                        </div>
                        ${createStatusPill(c.status)}
                    </div>
                    <div class="mt-4">
                        <p class="font-semibold text-slate-800">Room: ${c.room}</p>
                        <p class="text-slate-600 mt-1">${c.description}</p>
                    </div>
                    <div class="mt-4 border-t pt-3 space-x-2 flex justify-end">
                        ${c.status === 'Pending' ? `<button onclick="updateStatus(${c.id}, 'In Progress')" class="px-3 py-1 text-xs font-medium text-white bg-blue-600 rounded-full hover:bg-blue-700">Start Work</button>` : ''}
                        ${c.status === 'In Progress' ? `<button onclick="updateStatus(${c.id}, 'Resolved')" class="px-3 py-1 text-xs font-medium text-white bg-green-600 rounded-full hover:bg-green-700">Mark as Resolved</button>`: ''}
                    </div>
                </div>
            `).join('');

             if(myTasks.length === 0) {
                 maintenanceTasksContainer.innerHTML = '<p class="text-slate-500 text-center col-span-full">You have no pending tasks assigned.</p>';
            }
        }
        
        // --- HELPER & UTILITY FUNCTIONS ---
        function createStatusPill(status) {
            const statusClasses = {
                'Pending': 'status-pending',
                'In Progress': 'status-in-progress',
                'Resolved': 'status-resolved'
            };
            return `<span class="status-pill ${statusClasses[status]}">${status}</span>`;
        }
        
        function getStaffName(staffId) {
            const staff = maintenanceStaff.find(s => s.id === staffId);
            return staff ? staff.name : 'Unknown';
        }

        function createAssignDropdown(complaintId) {
            const options = maintenanceStaff.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
            return `
                <select onchange="assignTask(${complaintId}, this.value)" class="text-xs rounded-md border-slate-300 focus:ring-sky-500 focus:border-sky-500">
                    <option value="">Assign to...</option>
                    ${options}
                </select>
            `;
        }

        // --- ACTIONS ---
        function assignTask(complaintId, staffId) {
            if (!staffId) return;
            const complaint = complaints.find(c => c.id === complaintId);
            if (complaint) {
                complaint.assignedTo = staffId;
                complaint.status = 'In Progress';
                renderWardenComplaints();
            }
        }

        function updateStatus(complaintId, newStatus) {
            const complaint = complaints.find(c => c.id === complaintId);
            if (complaint) {
                complaint.status = newStatus;
                if(newStatus === 'Resolved') {
                    complaint.resolvedOn = new Date();
                }
                renderMaintenanceTasks();
            }
        }
        
        // --- MODAL HANDLING ---
        function openComplaintModal() { complaintModal.classList.remove('hidden'); }
        function closeComplaintModal() { complaintModal.classList.add('hidden'); complaintForm.reset(); }
        
        function openAnnouncementModal() { announcementModal.classList.remove('hidden'); }
        function closeAnnouncementModal() { announcementModal.classList.add('hidden'); announcementForm.reset(); }

        complaintForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newComplaint = {
                id: complaints.length + 1,
                ticketId: `HSTL-${Math.floor(1000 + Math.random() * 9000)}`,
                room: document.getElementById('room-number').value,
                category: document.getElementById('category').value,
                description: document.getElementById('description').value,
                status: 'Pending',
                assignedTo: null,
                filedOn: new Date(),
                studentId: MOCK_STUDENT_ID
            };
            complaints.push(newComplaint);
            renderStudentComplaints();
            closeComplaintModal();
        });

        announcementForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newAnnouncement = {
                id: announcements.length + 1,
                message: document.getElementById('announcement-text').value,
                postedOn: new Date()
            };
            announcements.push(newAnnouncement);
            // In a real app this would trigger a push notification or live update.
            // For now, students will see it when they next load their dashboard.
            closeAnnouncementModal();
        });

        // Initial check to see if a user is "logged in" from a previous session (for dev)
        // In a real app, this would be handled by checking localStorage for a token
        // For now, we start at the login page every time.
    </script>
</body>
</html>
